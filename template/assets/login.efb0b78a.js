import{u as v,E as f,n as x,i as y,p as E,s as m}from"./_element-plus.a7707325.js";import{X as k,Z as b,Y as j}from"./__vendor.467a6c12.js";import{_ as q,a as d}from"./index.1336ed74.js";import{f as p,o as S,S as C,T as r,_ as c,a as i,Z as T,aw as B,ax as I,Y as N}from"./_@vue.73c7d285.js";import"./_@element-plus.8770ec28.js";let u;const n=k.create({timeout:5e4}),h=e=>{u.close();let s={title:"",message:""};if(e.response)if(console.log(e.response.data),console.log(e.response.status),console.log(e.response.headers),s.title="\u9519\u8BEF"+e.response.status+" "+e.response.data.message,e.request.status==401&&window.location.reload(),Object.prototype.toString.call(e.response.data.errors)==="[object Object]"){for(const o in e.response.data.errors)if(Object.hasOwnProperty.call(e.response.data.errors,o)){const t=e.response.data.errors[o];s.message+=t.join(",")}}else s.message=e.response.data.errors;else e.request?console.log(e.request):console.log("Error",e.message);return f({title:s.title,type:"error",message:s.message}),console.log(e.message),Promise.reject(e)};n.interceptors.request.use(e=>(u=v.service({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.4)"}),e),h);n.interceptors.response.use(e=>{const{data:s}=e;return u.close(),s.code!==200?(f({title:"\u8BF7\u6C42\u5931\u8D25",message:s.message,type:"error"}),RegExp(/\"errno\":-6/).test(s.message)&&(window.location.href="/#/login"),Promise.reject(new Error(s.message||"Error"))):e},h);const O={setup(){const e=b(),s=p(""),o=p(""),t=p("");(()=>{n({url:d.getCode,method:"get"}).then(a=>{s.value=a.data.data.user_code,o.value=a.data.data.verification_url,t.value=a.data.data.qrcode_url})})();const g=()=>{n({url:d.getAccessToken,method:"get"}).then(a=>{a.data.code!==200?m.error("token\u83B7\u53D6\u5931\u8D25,\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u65B0\u6388\u6743"):n({url:d.getUserinfo,method:"get"}).then(_=>{m.success("\u6388\u6743\u6210\u529F"),e.push("/")})})};return j().commit("clearTags"),{user_code:s,verification_url:o,qrcode_url:t,getAccessToken:g}}},A=e=>(B("data-v-19c163d6"),e=e(),I(),e),P=A(()=>i("p",null,"\u626B\u4E8C\u7EF4\u7801",-1)),R=["src"],V=["src"],L=N("\u5DF2\u5B8C\u6210\u6388\u6743");function U(e,s,o,t,w,g){const l=x,a=y,_=E;return S(),C(_,{gutter:20},{default:r(()=>[c(l,{span:6},{default:r(()=>[P,i("img",{src:t.qrcode_url,alt:""},null,8,R)]),_:1}),c(l,{span:6},{default:r(()=>[i("p",null,"\u6216\u5728\u4E0B\u9762\u8F93\u5165:"+T(t.user_code),1),i("iframe",{src:t.verification_url,width:"500px",height:"500px",frameborder:"0",sandbox:"allow-scripts allow-forms allow-same-origin"},null,8,V)]),_:1}),c(l,{span:12,offset:6},{default:r(()=>[c(a,{style:{width:"100%"},size:"large",type:"primary",plain:"",onClick:s[0]||(s[0]=Y=>t.getAccessToken())},{default:r(()=>[L]),_:1})]),_:1})]),_:1})}var X=q(O,[["render",U],["__scopeId","data-v-19c163d6"]]);export{X as default};
